name: Dart

on: pull_request

jobs:
  format-lint-test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package: [sail_ui, sidesail, drivechain_client, faucet_client]

    defaults:
      run:
        working-directory: packages/${{ matrix.package }}

    steps:
      - uses: actions/checkout@v4
      - uses: subosito/flutter-action@v2
      
      - uses: dart-lang/setup-dart@v1

      - name: Install dependencies for ${{ matrix.package }}
        run: flutter pub get

      - name: Verify formatting for ${{ matrix.package }}
        run: find . -name "*.dart" -not -path "./lib/gen/*" | xargs dart format -l 120

      - name: Analyze project source for ${{ matrix.package }}
        run: dart analyze

      - name: Run tests for ${{ matrix.package }}
        run: |
          if [ -d "test" ]; then
            flutter test
          else
            echo "Test directory not found. Skipping tests."
          fi

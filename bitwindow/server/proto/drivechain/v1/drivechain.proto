syntax = "proto3";

package drivechain.v1;

service DrivechainService {
  rpc ListSidechains(ListSidechainsRequest) returns (ListSidechainsResponse);
  rpc ListSidechainProposals(ListSidechainProposalsRequest) returns (ListSidechainProposalsResponse);
  rpc ProposeSidechain(ProposeSidechainRequest) returns (ProposeSidechainResponse);
  rpc ListWithdrawals(ListWithdrawalsRequest) returns (ListWithdrawalsResponse);
}

message ListSidechainsRequest {}

message ListSidechainsResponse {
  message Sidechain {
    string title = 1;
    string description = 2;
    uint32 nversion = 3;
    string hashid1 = 4;
    string hashid2 = 5;
    uint32 slot = 6;
    uint32 vote_count = 7;
    uint32 proposal_height = 8;
    uint32 activation_height = 9;
    string description_hex = 10;

    int64 balance_satoshi = 11;
    string chaintip_txid = 12;
    uint32 chaintip_vout = 13;
  }

  repeated Sidechain sidechains = 1;
}

message ListSidechainProposalsRequest {}

message SidechainProposal {
  uint32 slot = 1;
  bytes data = 2;
  string data_hash = 3;
  uint32 vote_count = 4;
  uint32 proposal_height = 5;
  uint32 proposal_age = 6;
}

message ListSidechainProposalsResponse {
  repeated SidechainProposal proposals = 1;
}

message ProposeSidechainRequest {
  uint32 slot = 1;
  string title = 2;
  string description = 3;
  uint32 version = 4;
  string hashid1 = 5;
  string hashid2 = 6;
}

message ProposeSidechainResponse {
  bool success = 1;
  string proposal_hash = 2;
  string message = 3;
}

message ListWithdrawalsRequest {
  uint32 sidechain_id = 1;
  uint32 start_block_height = 2;
  uint32 end_block_height = 3;
}

message WithdrawalBundle {
  string m6id = 1;
  uint32 sidechain_id = 2;
  string status = 3; // "succeeded", "failed", "pending"
  uint64 sequence_number = 4;
  string transaction_hex = 5;
  uint32 block_height = 6; // Block when bundle was submitted

  // Score tracking fields (BIP300)
  uint32 age = 7;          // Blocks since submission
  uint32 max_age = 8;      // Maximum voting period (26300 blocks)
  uint32 blocks_left = 9;  // Remaining blocks before expiry
}

message ListWithdrawalsResponse {
  repeated WithdrawalBundle bundles = 1;
}
